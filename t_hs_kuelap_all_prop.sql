{{ config(
    cluster_by = "_airbyte_emitted_at",
    partition_by = {"field": "_airbyte_emitted_at", "data_type": "timestamp", "granularity": "day"},
    schema = "Hubspot_Deals",
    tags = [ "nested" ]
) }}
-- Final base SQL model
-- depends_on: {{ ref('companies_properties_ab3') }}
select
    _airbyte_companies_hashid,
    zip,
    city,
    name,
    type,
    phone,
    state,
    domain,
    address,
    country,
    website,
    about_us,
    address2,
    bankable,
    currency,
    industry,
    timezone,
    closedate,
    coop_type,
    is_public,
    num_notes,
    createdate,
    twitterbio,
    coop_assets,
    coop_member,
    description,
    hs_pipeline,
    linkedinbio,
    facebookfans,
    founded_year,
    hs_object_id as DealId,
    hubspotscore,
    annualrevenue,
    days_to_close,
    hs_createdate,
    rat_3_tahunan,
    total_revenue,
    twitterhandle,
    hs_lead_status,
    lifecyclestage,
    migration_data,
    migration_type,
    googleplus_page,
    hs_all_team_ids,
    hs_num_blockers,
    hs_time_in_lead,
    hubspot_team_id,
    migration_owner,
    hs_all_owner_ids,
    hs_time_in_other,
    hubspot_owner_id,
    twitterfollowers,
    web_technologies,
    hs_num_open_deals,
    hs_target_account,
    numberofemployees,
    loan_type_required,
    notes_last_updated,
    recent_deal_amount,
    total_money_raised,
    hs_analytics_source,
    hs_date_exited_lead,
    hs_lastmodifieddate,
    hs_time_in_customer,
    hs_total_deal_value,
    num_contacted_notes,
    hs_date_entered_lead,
    hs_date_exited_other,
    hs_is_target_account,
    hs_merged_object_ids,
    hs_parent_company_id,
    notes_last_contacted,
    num_associated_deals,
    preffered_loan_model,
    facebook_company_page,
    first_conversion_date,
    hs_additional_domains,
    hs_created_by_user_id,
    hs_date_entered_other,
    hs_time_in_evangelist,
    hs_time_in_subscriber,
    hs_updated_by_user_id,
    linkedin_company_page,
    num_conversion_events,
    hs_last_open_task_date,
    hs_num_child_companies,
    hs_num_decision_makers,
    hs_time_in_opportunity,
    hs_unique_creation_key,
    recent_conversion_date,
    recent_deal_close_date,
    first_deal_created_date,
    hs_analytics_num_visits,
    hs_date_exited_customer,
    num_associated_contacts,
    update_time__migration_,
    first_contact_createdate,
    hs_date_entered_customer,
    hs_last_logged_call_date,
    nlp__net_loan_portfolio_,
    notes_next_activity_date,
    usp__unit_simpan_pinjam_,
    hs_avatar_filemanager_key,
    hs_date_exited_evangelist,
    hs_date_exited_subscriber,
    hs_ideal_customer_profile,
    hs_user_ids_of_all_owners,
    glp__gross_loan_portfolio_,
    hs_all_accessible_team_ids,
    hs_analytics_source_data_1,
    hs_analytics_source_data_2,
    hs_date_entered_evangelist,
    hs_date_entered_subscriber,
    hs_date_exited_opportunity,
    hs_latest_meeting_activity,
    hubspot_owner_assigneddate,
    first_conversion_event_name,
    hs_analytics_last_timestamp,
    hs_analytics_num_page_views,
    hs_date_entered_opportunity,
    hs_last_booked_meeting_date,
    hs_last_sales_activity_date,
    hs_sales_email_last_replied,
    hs_analytics_first_timestamp,
    recent_conversion_event_name,
    hs_target_account_probability,
    hs_time_in_salesqualifiedlead,
    engagements_last_meeting_booked,
    hs_last_sales_activity_timestamp,
    organization_created__migration_,
    hs_all_assigned_business_unit_ids,
    hs_analytics_last_visit_timestamp,
    hs_date_exited_salesqualifiedlead,
    hs_num_contacts_with_buying_roles,
    hs_time_in_marketingqualifiedlead,
    hs_analytics_first_visit_timestamp,
    hs_date_entered_salesqualifiedlead,
    total_potential_members__migration_,
    hs_date_exited_marketingqualifiedlead,
    engagements_last_meeting_booked_medium,
    engagements_last_meeting_booked_source,
    hs_date_entered_marketingqualifiedlead,
    hs_target_account_recommendation_state,
    engagements_last_meeting_booked_campaign,
    hs_user_ids_of_all_notification_followers,
    closedate_timestamp_earliest_value_a2a17e6e,
    hs_analytics_last_touch_converting_campaign,
    hs_user_ids_of_all_notification_unfollowers,
    hs_analytics_first_touch_converting_campaign,
    hs_latest_createdate_of_active_subscriptions,
    hs_target_account_recommendation_snooze_time,
    loan_that_needed_for_coop_member_disbursement,
    num_conversion_events_cardinality_sum_d095f14b,
    hs_analytics_num_visits_cardinality_sum_53d952a6,
    hs_predictivecontactscore_v2_next_max_max_d4e58c1e,
    hs_analytics_num_page_views_cardinality_sum_e46e85b0,
    hs_analytics_source_timestamp_earliest_value_25a3a52c,
    recent_conversion_date_timestamp_latest_value_72856da1,
    first_conversion_date_timestamp_earliest_value_61f58f2c,
    first_contact_createdate_timestamp_earliest_value_78b50eea,
    hs_analytics_last_timestamp_timestamp_latest_value_4e16365a,
    hs_analytics_source_data_1_timestamp_earliest_value_9b2f1fa1,
    hs_analytics_source_data_2_timestamp_earliest_value_9b2f9400,
    recent_conversion_event_name_timestamp_latest_value_66c820bf,
    first_conversion_event_name_timestamp_earliest_value_68ddae0a,
    hs_analytics_first_timestamp_timestamp_earliest_value_11e3a63a,
    hs_analytics_last_visit_timestamp_timestamp_latest_value_999a0fce,
    hs_analytics_first_visit_timestamp_timestamp_earliest_value_accc17ae,
    hs_analytics_last_touch_converting_campaign_timestamp_latest_value_81a64e30,
    hs_analytics_first_touch_converting_campaign_timestamp_earliest_value_4757fe10,
    _airbyte_ab_id,
    _airbyte_emitted_at,
    {{ current_timestamp() }} as _airbyte_normalized_at,
    _airbyte_properties_hashid
from {{ ref('companies_properties_ab3') }}
-- properties at companies/properties from {{ ref('companies') }}
where 1 = 1

{{ config(
    cluster_by = "_airbyte_emitted_at",
    partition_by = {"field": "_airbyte_emitted_at", "data_type": "timestamp", "granularity": "day"},
    schema = "Hubspot_Deals",
    tags = [ "nested" ]
) }}
-- Final base SQL model
-- depends_on: {{ ref('contacts_properties_ab3') }}
select
    _airbyte_contacts_hashid,
    fax,
    zip,
    city,
    email,
    phone,
    state,
    degree,
    gender,
    school,
    address,
    company,
    country,
    ip_city,
    jabatan,
    message,
    phone_2,
    phone_3,
    phone_4,
    phone_5,
    phone_6,
    phone_7,
    phone_8,
    website,
    industry,
    ip_state,
    jobtitle,
    lastname,
    closedate,
    firstname,
    ip_latlon,
    num_notes,
    seniority,
    createdate,
    hs_persona,
    ip_country,
    ip_zipcode,
    salutation,
    start_date,
    work_email,
    coop_member,
    hs_language,
    hs_pipeline,
    hs_timezone,
    mobilephone,
    company_size,
    hs_object_id as DealId,
    hs_testpurge,
    hubspotscore,
    job_function,
    leads_source,
    numemployees,
    annualrevenue,
    date_of_birth,
    days_to_close,
    hs_createdate,
    hs_email_open,
    hs_is_contact,
    ip_state_code,
    total_revenue,
    twitterhandle,
    field_of_study,
    hs_buying_role,
    hs_email_click,
    hs_ip_timezone,
    hs_is_unworked,
    hs_lead_status,
    hs_legal_basis,
    lifecyclestage,
    marital_status,
    migration_data,
    area_jawa_barat,
    graduation_date,
    hs_all_team_ids,
    hs_email_bounce,
    hs_email_domain,
    hs_email_optout,
    hs_testrollback,
    hs_time_in_lead,
    hubspot_team_id,
    ip_country_code,
    migration_owner,
    military_status,
    area_jawa_tengah,
    hs_all_owner_ids,
    hs_email_replied,
    hs_latest_source,
    hs_time_in_other,
    hubspot_owner_id,
    lastmodifieddate,
    hs_count_is_worked,
    hs_email_delivered,
    hs_google_click_id,
    notes_last_updated,
    recent_deal_amount,
    wilayah___provinsi,
    associatedcompanyid,
    currentlyinworkflow,
    hs_all_contact_vids,
    hs_analytics_source,
    hs_date_exited_lead,
    hs_lastmodifieddate,
    hs_time_in_customer,
    num_contacted_notes,
    relationship_status,
    hs_additional_emails,
    hs_analytics_revenue,
    hs_count_is_unworked,
    hs_date_entered_lead,
    hs_date_exited_other,
    hs_email_bad_address,
    hs_email_quarantined,
    hs_facebook_click_id,
    hs_marketable_status,
    hs_merged_object_ids,
    notes_last_contacted,
    num_associated_deals,
    first_conversion_date,
    hs_analytics_last_url,
    hs_created_by_user_id,
    hs_date_entered_other,
    hs_time_in_evangelist,
    hs_time_in_subscriber,
    hs_updated_by_user_id,
    num_conversion_events,
    range_assets_koperasi,
    hs_analytics_first_url,
    hs_clicked_linkedin_ad,
    hs_email_is_ineligible,
    hs_facebook_ad_clicked,
    hs_linkedin_ad_clicked,
    hs_time_in_opportunity,
    hs_unique_creation_key,
    kota_madya___kabupaten,
    recent_conversion_date,
    recent_deal_close_date,
    first_deal_created_date,
    hs_analytics_num_visits,
    hs_date_exited_customer,
    hs_email_last_open_date,
    hs_email_last_send_date,
    hs_latest_source_data_1,
    hs_latest_source_data_2,
    hs_marketable_reason_id,
    hs_pinned_engagement_id,
    update_time__migration_,
    webinareventlastupdated,
    hs_date_entered_customer,
    hs_email_first_open_date,
    hs_email_first_send_date,
    hs_email_last_click_date,
    hs_email_last_email_name,
    hs_email_last_reply_date,
    hs_email_optout_38263792,
    hs_email_optout_38293744,
    hs_email_optout_39197512,
    hs_email_optout_47253995,
    hs_sequences_is_enrolled,
    notes_next_activity_date,
    hs_avatar_filemanager_key,
    hs_calculated_merged_vids,
    hs_date_exited_evangelist,
    hs_date_exited_subscriber,
    hs_email_first_click_date,
    hs_email_first_reply_date,
    hs_marketable_reason_type,
    hs_user_ids_of_all_owners,
    hs_all_accessible_team_ids,
    hs_analytics_last_referrer,
    hs_analytics_source_data_1,
    hs_analytics_source_data_2,
    hs_calculated_phone_number,
    hs_date_entered_evangelist,
    hs_date_entered_subscriber,
    hs_date_exited_opportunity,
    hs_document_last_revisited,
    hs_emailconfirmationstatus,
    hs_has_active_subscription,
    hs_latest_meeting_activity,
    hs_sales_email_last_opened,
    hubspot_owner_assigneddate,
    first_conversion_event_name,
    hs_analytics_first_referrer,
    hs_analytics_last_timestamp,
    hs_analytics_num_page_views,
    hs_calculated_mobile_number,
    hs_content_membership_notes,
    hs_created_by_conversations,
    hs_date_entered_opportunity,
    hs_email_hard_bounce_reason,
    hs_email_quarantined_reason,
    hs_feedback_last_nps_rating,
    hs_last_sales_activity_date,
    hs_latest_sequence_enrolled,
    hs_lifecyclestage_lead_date,
    hs_marketable_until_renewal,
    hs_sa_first_engagement_date,
    hs_sales_email_last_clicked,
    hs_sales_email_last_replied,
    hs_sequences_enrolled_count,
    hs_time_to_first_engagement,
    associatedcompanylastupdated,
    hs_analytics_first_timestamp,
    hs_content_membership_status,
    hs_feedback_last_survey_date,
    hs_lifecyclestage_other_date,
    hs_sa_first_engagement_descr,
    num_unique_conversion_events,
    recent_conversion_event_name,
    surveymonkeyeventlastupdated,
    hs_first_engagement_object_id,
    hs_latest_sequence_ended_date,
    hs_time_in_salesqualifiedlead,
    hs_calculated_form_submissions,
    hs_conversations_visitor_email,
    hs_feedback_last_nps_follow_up,
    engagements_last_meeting_booked,
    hs_analytics_average_page_views,
    hs_feedback_show_nps_web_survey,
    hs_lifecyclestage_customer_date,
    hs_email_hard_bounce_reason_enum,
    hs_last_sales_activity_timestamp,
    hs_latest_sequence_enrolled_date,
    hs_latest_sequence_finished_date,
    hs_analytics_last_visit_timestamp,
    hs_date_exited_salesqualifiedlead,
    hs_first_subscription_create_date,
    hs_lifecyclestage_evangelist_date,
    hs_lifecyclestage_subscriber_date,
    hs_time_in_marketingqualifiedlead,
    range_glp__gross_loan_portofolio_,
    hs_analytics_first_visit_timestamp,
    hs_analytics_num_event_completions,
    hs_date_entered_salesqualifiedlead,
    hs_latest_sequence_unenrolled_date,
    hs_latest_subscription_create_date,
    hs_lifecyclestage_opportunity_date,
    hs_sa_first_engagement_object_type,
    hs_content_membership_registered_at,
    hs_calculated_phone_number_area_code,
    hs_email_customer_quarantined_reason,
    hs_email_sends_since_last_engagement,
    hs_sequences_actively_enrolled_count,
    hs_content_membership_email_confirmed,
    hs_date_exited_marketingqualifiedlead,
    hs_searchable_calculated_phone_number,
    hs_time_to_move_from_lead_to_customer,
    engagements_last_meeting_booked_medium,
    engagements_last_meeting_booked_source,
    hs_calculated_phone_number_region_code,
    hs_date_entered_marketingqualifiedlead,
    hs_searchable_calculated_mobile_number,
    hs_calculated_phone_number_country_code,
    engagements_last_meeting_booked_campaign,
    blog_kuelap_blog_74757455910_subscription,
    hs_lifecyclestage_salesqualifiedlead_date,
    hs_user_ids_of_all_notification_followers,
    hs_analytics_last_touch_converting_campaign,
    hs_time_to_move_from_subscriber_to_customer,
    hs_user_ids_of_all_notification_unfollowers,
    hs_analytics_first_touch_converting_campaign,
    hs_time_to_move_from_opportunity_to_customer,
    hs_lifecyclestage_marketingqualifiedlead_date,
    hs_time_between_contact_creation_and_deal_close,
    hs_content_membership_registration_email_sent_at,
    hs_content_membership_registration_domain_sent_to,
    hs_time_between_contact_creation_and_deal_creation,
    hs_searchable_calculated_international_phone_number,
    hs_time_to_move_from_salesqualifiedlead_to_customer,
    hs_searchable_calculated_international_mobile_number,
    hs_time_to_move_from_marketingqualifiedlead_to_customer,
    _airbyte_ab_id,
    _airbyte_emitted_at,
    {{ current_timestamp() }} as _airbyte_normalized_at,
    _airbyte_properties_hashid
from {{ ref('contacts_properties_ab3') }}
-- properties at contacts/properties from {{ ref('contacts') }}
where 1 = 1

{{ config(
    cluster_by = "_airbyte_emitted_at",
    partition_by = {"field": "_airbyte_emitted_at", "data_type": "timestamp", "granularity": "day"},
    schema = "Hubspot_Deals",
    tags = [ "nested" ]
) }}
-- Final base SQL model
-- depends_on: {{ ref('deals_properties_ab3') }}
select
    _airbyte_deals_hashid,
    amount,
    hs_acv,
    hs_arr,
    hs_mrr,
    hs_tcv,
    bankable,
    dealname,
    dealtype,
    pipeline,
    closedate,
    dealstage,
    fs_status,
    num_notes,
    sd_status,
    createdate,
    coop_member,
    description,
    hs_campaign,
    hs_priority,
    minimum_glp,
    reason_code,
    hs_is_closed,
    hs_next_step,
    hs_object_id as DealId,
    lender_match,
    tipe_migrasi,
    days_to_close,
    hs_createdate,
    jumlah_cabang,
    loan_capacity,
    rat_3_tahunan,
    tipe_koperasi,
    mapping_ticket,
    migration_data,
    minimum_assets,
    assets_koperasi,
    contract_number,
    hs_all_team_ids,
    hubspot_team_id,
    migration_owner,
    produk_pinjaman,
    hs_all_owner_ids,
    hs_closed_amount,
    hs_is_closed_won,
    hubspot_owner_id,
    pipeline_by_area,
    closed_won_reason,
    closed_lost_reason,
    deal_currency_code,
    hs_forecast_amount,
    loan_qualification,
    loan_type_required,
    notes_last_updated,
    hs_analytics_source,
    hs_lastmodifieddate,
    hs_predicted_amount,
    hs_projected_amount,
    hs_time_in_19987973,
    hs_time_in_19987974,
    hs_time_in_19987975,
    hs_time_in_19987976,
    hs_time_in_19987977,
    hs_time_in_19987979,
    hs_time_in_19987980,
    hs_time_in_19987981,
    hs_time_in_19987982,
    hs_time_in_19992972,
    hs_time_in_21129895,
    hs_time_in_25154955,
    hs_time_in_25154956,
    hs_time_in_25154957,
    hs_time_in_25154958,
    hs_time_in_25154959,
    hs_time_in_25154960,
    hs_time_in_25154961,
    hs_time_in_25497678,
    num_contacted_notes,
    hs_merged_object_ids,
    hs_time_in_closedwon,
    notes_last_contacted,
    preffered_loan_model,
    proj__loan_fees__1__,
    won_date__migration_,
    hs_created_by_user_id,
    hs_time_in_closedlost,
    hs_updated_by_user_id,
    hs_likelihood_to_close,
    hs_num_target_accounts,
    hs_unique_creation_key,
    last_stage__migration_,
    amount_in_home_currency,
    hs_date_exited_19987973,
    hs_date_exited_19987974,
    hs_date_exited_19987975,
    hs_date_exited_19987976,
    hs_date_exited_19987977,
    hs_date_exited_19987979,
    hs_date_exited_19987980,
    hs_date_exited_19987981,
    hs_date_exited_19987982,
    hs_date_exited_19992972,
    hs_date_exited_21129895,
    hs_date_exited_25154955,
    hs_date_exited_25154956,
    hs_date_exited_25154957,
    hs_date_exited_25154958,
    hs_date_exited_25154959,
    hs_date_exited_25154960,
    hs_date_exited_25154961,
    hs_date_exited_25497678,
    hs_forecast_probability,
    hs_time_in_contractsent,
    num_associated_contacts,
    update_date__migration_,
    hs_date_entered_19987973,
    hs_date_entered_19987974,
    hs_date_entered_19987975,
    hs_date_entered_19987976,
    hs_date_entered_19987977,
    hs_date_entered_19987979,
    hs_date_entered_19987980,
    hs_date_entered_19987981,
    hs_date_entered_19987982,
    hs_date_entered_19992972,
    hs_date_entered_21129895,
    hs_date_entered_25154955,
    hs_date_entered_25154956,
    hs_date_entered_25154957,
    hs_date_entered_25154958,
    hs_date_entered_25154959,
    hs_date_entered_25154960,
    hs_date_entered_25154961,
    hs_date_entered_25497678,
    hs_date_exited_closedwon,
    notes_next_activity_date,
    usp__unit_simpan_pinjam_,
    hs_date_entered_closedwon,
    hs_date_exited_closedlost,
    hs_deal_stage_probability,
    hs_time_in_qualifiedtobuy,
    hs_user_ids_of_all_owners,
    maximum_lending_per_month,
    npl__non_performing_loan_,
    glp__gross_loan_portfolio_,
    hs_all_accessible_team_ids,
    hs_analytics_source_data_1,
    hs_analytics_source_data_2,
    hs_date_entered_closedlost,
    hs_latest_meeting_activity,
    hubspot_owner_assigneddate,
    deal_close_date__migration_,
    hs_all_deal_split_owner_ids,
    hs_date_exited_contractsent,
    hs_manual_forecast_category,
    hs_sales_email_last_replied,
    hs_date_entered_contractsent,
    ksp__koperasi_simpan_pinjam_,
    hs_all_collaborator_owner_ids,
    hs_date_exited_qualifiedtobuy,
    hs_date_entered_qualifiedtobuy,
    engagements_last_meeting_booked,
    hs_time_in_appointmentscheduled,
    hs_deal_stage_probability_shadow,
    hs_time_in_decisionmakerboughtin,
    hs_time_in_presentationscheduled,
    hs_all_assigned_business_unit_ids,
    hs_closed_amount_in_home_currency,
    hs_date_exited_appointmentscheduled,
    hs_date_entered_appointmentscheduled,
    hs_date_exited_decisionmakerboughtin,
    hs_date_exited_presentationscheduled,
    hs_predicted_amount_in_home_currency,
    hs_projected_amount_in_home_currency,
    hs_date_entered_decisionmakerboughtin,
    hs_date_entered_presentationscheduled,
    hs_deal_amount_calculation_preference,
    engagements_last_meeting_booked_medium,
    engagements_last_meeting_booked_source,
    engagements_last_meeting_booked_campaign,
    hs_user_ids_of_all_notification_followers,
    hs_user_ids_of_all_notification_unfollowers,
    projected_loan_vol____25__glp___20__assets_,
    hs_line_item_global_term_hs_discount_percentage,
    hs_line_item_global_term_recurringbillingfrequency,
    hs_line_item_global_term_hs_recurring_billing_period,
    hs_line_item_global_term_hs_discount_percentage_enabled,
    hs_line_item_global_term_hs_recurring_billing_start_date,
    hs_line_item_global_term_recurringbillingfrequency_enabled,
    jumlah_pinjaman_yang_diinginkan_untuk_koperasi__executing_,
    jumlah_pinjaman_yangg_diinginkan_untuk_anggota__channeling_,
    hs_line_item_global_term_hs_recurring_billing_period_enabled,
    hs_line_item_global_term_hs_recurring_billing_start_date_enabled,
    _airbyte_ab_id,
    _airbyte_emitted_at,
    {{ current_timestamp() }} as _airbyte_normalized_at,
    _airbyte_properties_hashid
from {{ ref('deals_properties_ab3') }}
-- properties at deals/properties from {{ ref('deals') }}
where 1 = 1

{{ config(
    cluster_by = "_airbyte_emitted_at",
    partition_by = {"field": "_airbyte_emitted_at", "data_type": "timestamp", "granularity": "day"},
    schema = "Hubspot_Deals",
    tags = [ "nested" ]
) }}
-- Final base SQL model
-- depends_on: {{ ref('property_history_properties_ab3') }}
select
    _airbyte_property_history_hashid,
    fax,
    zip,
    city,
    email,
    phone,
    state,
    degree,
    gender,
    school,
    address,
    company,
    country,
    ip_city,
    jabatan,
    message,
    phone_2,
    phone_3,
    phone_4,
    phone_5,
    phone_6,
    phone_7,
    phone_8,
    website,
    industry,
    ip_state,
    jobtitle,
    lastname,
    closedate,
    firstname,
    ip_latlon,
    num_notes,
    seniority,
    createdate,
    hs_persona,
    ip_country,
    ip_zipcode,
    salutation,
    start_date,
    work_email,
    coop_member,
    hs_language,
    hs_pipeline,
    hs_timezone,
    mobilephone,
    company_size,
    hs_object_id,
    hs_testpurge,
    hubspotscore,
    job_function,
    leads_source,
    numemployees,
    annualrevenue,
    date_of_birth,
    days_to_close,
    hs_createdate,
    hs_email_open,
    hs_is_contact,
    ip_state_code,
    total_revenue,
    twitterhandle,
    field_of_study,
    hs_buying_role,
    hs_email_click,
    hs_ip_timezone,
    hs_is_unworked,
    hs_lead_status,
    hs_legal_basis,
    lifecyclestage,
    marital_status,
    migration_data,
    area_jawa_barat,
    graduation_date,
    hs_all_team_ids,
    hs_email_bounce,
    hs_email_domain,
    hs_email_optout,
    hs_testrollback,
    hs_time_in_lead,
    hubspot_team_id,
    ip_country_code,
    migration_owner,
    military_status,
    area_jawa_tengah,
    hs_all_owner_ids,
    hs_email_replied,
    hs_latest_source,
    hs_time_in_other,
    hubspot_owner_id,
    lastmodifieddate,
    hs_count_is_worked,
    hs_email_delivered,
    hs_google_click_id,
    notes_last_updated,
    recent_deal_amount,
    wilayah___provinsi,
    associatedcompanyid,
    currentlyinworkflow,
    hs_all_contact_vids,
    hs_analytics_source,
    hs_date_exited_lead,
    hs_lastmodifieddate,
    hs_time_in_customer,
    num_contacted_notes,
    relationship_status,
    hs_additional_emails,
    hs_analytics_revenue,
    hs_count_is_unworked,
    hs_date_entered_lead,
    hs_date_exited_other,
    hs_email_bad_address,
    hs_email_quarantined,
    hs_facebook_click_id,
    hs_marketable_status,
    hs_merged_object_ids,
    notes_last_contacted,
    num_associated_deals,
    first_conversion_date,
    hs_analytics_last_url,
    hs_created_by_user_id,
    hs_date_entered_other,
    hs_time_in_evangelist,
    hs_time_in_subscriber,
    hs_updated_by_user_id,
    num_conversion_events,
    range_assets_koperasi,
    hs_analytics_first_url,
    hs_clicked_linkedin_ad,
    hs_email_is_ineligible,
    hs_facebook_ad_clicked,
    hs_linkedin_ad_clicked,
    hs_time_in_opportunity,
    hs_unique_creation_key,
    kota_madya___kabupaten,
    recent_conversion_date,
    recent_deal_close_date,
    first_deal_created_date,
    hs_analytics_num_visits,
    hs_date_exited_customer,
    hs_email_last_open_date,
    hs_email_last_send_date,
    hs_latest_source_data_1,
    hs_latest_source_data_2,
    hs_marketable_reason_id,
    hs_pinned_engagement_id,
    update_time__migration_,
    webinareventlastupdated,
    hs_date_entered_customer,
    hs_email_first_open_date,
    hs_email_first_send_date,
    hs_email_last_click_date,
    hs_email_last_email_name,
    hs_email_last_reply_date,
    hs_email_optout_38263792,
    hs_email_optout_38293744,
    hs_email_optout_39197512,
    hs_email_optout_47253995,
    hs_sequences_is_enrolled,
    notes_next_activity_date,
    hs_avatar_filemanager_key,
    hs_calculated_merged_vids,
    hs_date_exited_evangelist,
    hs_date_exited_subscriber,
    hs_email_first_click_date,
    hs_email_first_reply_date,
    hs_marketable_reason_type,
    hs_user_ids_of_all_owners,
    hs_all_accessible_team_ids,
    hs_analytics_last_referrer,
    hs_analytics_source_data_1,
    hs_analytics_source_data_2,
    hs_calculated_phone_number,
    hs_date_entered_evangelist,
    hs_date_entered_subscriber,
    hs_date_exited_opportunity,
    hs_document_last_revisited,
    hs_emailconfirmationstatus,
    hs_has_active_subscription,
    hs_latest_meeting_activity,
    hs_sales_email_last_opened,
    hubspot_owner_assigneddate,
    first_conversion_event_name,
    hs_analytics_first_referrer,
    hs_analytics_last_timestamp,
    hs_analytics_num_page_views,
    hs_calculated_mobile_number,
    hs_content_membership_notes,
    hs_created_by_conversations,
    hs_date_entered_opportunity,
    hs_email_hard_bounce_reason,
    hs_email_quarantined_reason,
    hs_feedback_last_nps_rating,
    hs_last_sales_activity_date,
    hs_latest_sequence_enrolled,
    hs_lifecyclestage_lead_date,
    hs_marketable_until_renewal,
    hs_sa_first_engagement_date,
    hs_sales_email_last_clicked,
    hs_sales_email_last_replied,
    hs_sequences_enrolled_count,
    hs_time_to_first_engagement,
    associatedcompanylastupdated,
    hs_analytics_first_timestamp,
    hs_content_membership_status,
    hs_feedback_last_survey_date,
    hs_lifecyclestage_other_date,
    hs_sa_first_engagement_descr,
    num_unique_conversion_events,
    recent_conversion_event_name,
    surveymonkeyeventlastupdated,
    hs_first_engagement_object_id,
    hs_latest_sequence_ended_date,
    hs_time_in_salesqualifiedlead,
    hs_calculated_form_submissions,
    hs_conversations_visitor_email,
    hs_feedback_last_nps_follow_up,
    engagements_last_meeting_booked,
    hs_analytics_average_page_views,
    hs_feedback_show_nps_web_survey,
    hs_lifecyclestage_customer_date,
    hs_email_hard_bounce_reason_enum,
    hs_last_sales_activity_timestamp,
    hs_latest_sequence_enrolled_date,
    hs_latest_sequence_finished_date,
    hs_analytics_last_visit_timestamp,
    hs_date_exited_salesqualifiedlead,
    hs_first_subscription_create_date,
    hs_lifecyclestage_evangelist_date,
    hs_lifecyclestage_subscriber_date,
    hs_time_in_marketingqualifiedlead,
    range_glp__gross_loan_portofolio_,
    hs_analytics_first_visit_timestamp,
    hs_analytics_num_event_completions,
    hs_date_entered_salesqualifiedlead,
    hs_latest_sequence_unenrolled_date,
    hs_latest_subscription_create_date,
    hs_lifecyclestage_opportunity_date,
    hs_sa_first_engagement_object_type,
    hs_content_membership_registered_at,
    hs_calculated_phone_number_area_code,
    hs_email_customer_quarantined_reason,
    hs_email_sends_since_last_engagement,
    hs_sequences_actively_enrolled_count,
    hs_content_membership_email_confirmed,
    hs_date_exited_marketingqualifiedlead,
    hs_searchable_calculated_phone_number,
    hs_time_to_move_from_lead_to_customer,
    engagements_last_meeting_booked_medium,
    engagements_last_meeting_booked_source,
    hs_calculated_phone_number_region_code,
    hs_date_entered_marketingqualifiedlead,
    hs_searchable_calculated_mobile_number,
    hs_calculated_phone_number_country_code,
    engagements_last_meeting_booked_campaign,
    blog_kuelap_blog_74757455910_subscription,
    hs_lifecyclestage_salesqualifiedlead_date,
    hs_user_ids_of_all_notification_followers,
    hs_analytics_last_touch_converting_campaign,
    hs_time_to_move_from_subscriber_to_customer,
    hs_user_ids_of_all_notification_unfollowers,
    hs_analytics_first_touch_converting_campaign,
    hs_time_to_move_from_opportunity_to_customer,
    hs_lifecyclestage_marketingqualifiedlead_date,
    hs_time_between_contact_creation_and_deal_close,
    hs_content_membership_registration_email_sent_at,
    hs_content_membership_registration_domain_sent_to,
    hs_time_between_contact_creation_and_deal_creation,
    hs_searchable_calculated_international_phone_number,
    hs_time_to_move_from_salesqualifiedlead_to_customer,
    hs_searchable_calculated_international_mobile_number,
    hs_time_to_move_from_marketingqualifiedlead_to_customer,
    _airbyte_ab_id,
    _airbyte_emitted_at,
    {{ current_timestamp() }} as _airbyte_normalized_at,
    _airbyte_properties_hashid
from {{ ref('property_history_properties_ab3') }}
-- properties at property_history/properties from {{ ref('property_history') }}
where 1 = 1

{{ config(
    cluster_by = "_airbyte_emitted_at",
    partition_by = {"field": "_airbyte_emitted_at", "data_type": "timestamp", "granularity": "day"},
    schema = "Hubspot_Deals",
    tags = [ "nested" ]
) }}
-- Final base SQL model
-- depends_on: {{ ref('tickets_properties_ab3') }}
select
    _airbyte_tickets_hashid,
    tags,
    test,
    phase,
    content,
    subject,
    qa_check,
    nps_score,
    num_notes,
    tenant_id,
    created_by,
    createdate,
    issue_area,
    sla_status,
    source_ref,
    ticket_age,
    closed_date,
    hs_pipeline,
    priority_cs,
    source_type,
    ticket_note,
    hs_object_id,
    hs_ticket_id,
    hs_time_in_1,
    hs_time_in_2,
    hs_time_in_3,
    hs_time_in_4,
    hs_createdate,
    hs_resolution,
    sla_timestamp,
    time_to_close,
    hs_file_upload,
    sub_categories,
    hs_all_team_ids,
    hs_custom_inbox,
    hubspot_team_id,
    last_reply_date,
    lending_partner,
    next_plan_notes,
    ticket_priority,
    hs_all_owner_ids,
    hs_date_exited_1,
    hs_date_exited_2,
    hs_date_exited_3,
    hs_date_exited_4,
    hs_lastcontacted,
    hubspot_owner_id,
    si_jira_issue_id,
    source_thread_id,
    attachment_status,
    hs_date_entered_1,
    hs_date_entered_2,
    hs_date_entered_3,
    hs_date_entered_4,
    hs_pipeline_stage,
    si_jira_issue_key,
    hs_last_email_date,
    hs_ticket_category,
    hs_ticket_priority,
    notes_last_updated,
    si_jira_issue_link,
    si_jira_sync_notes,
    actual_disbursement,
    hs_lastactivitydate,
    hs_lastmodifieddate,
    hs_nextactivitydate,
    hs_time_in_19987999,
    hs_time_in_19988000,
    hs_time_in_19988001,
    hs_time_in_19988002,
    hs_time_in_19992996,
    hs_time_in_19992999,
    hs_time_in_19993000,
    hs_time_in_19993001,
    hs_time_in_20860049,
    hs_time_in_20860050,
    hs_time_in_20860051,
    hs_time_in_21245461,
    hs_time_in_21245462,
    hs_time_in_21245463,
    hs_time_in_21245465,
    hs_time_in_21245466,
    hs_time_in_21245467,
    hs_time_in_21245468,
    hs_time_in_21245470,
    hs_time_in_23368876,
    hs_time_in_23368877,
    hs_time_in_23368878,
    hs_time_in_24116806,
    hs_time_in_24116807,
    hs_time_in_24116808,
    hs_time_in_24116809,
    hs_time_in_25639711,
    hs_time_in_25639712,
    hs_time_in_25656404,
    hs_time_in_26202701,
    hs_time_in_26212533,
    hs_time_in_26589470,
    hs_time_in_26770989,
    hs_time_in_26868919,
    hs_time_in_27626397,
    hs_time_in_27626398,
    hs_time_in_27672668,
    hs_time_in_27687309,
    hs_time_in_27687310,
    hs_time_in_27687311,
    hs_time_in_27687312,
    hs_time_in_27762617,
    hs_time_in_27762688,
    hs_time_in_27762689,
    hs_time_in_27762690,
    num_contacted_notes,
    hs_merged_object_ids,
    last_engagement_date,
    notes_last_contacted,
    nps_follow_up_answer,
    sales_of_this_ticket,
    si_jira_issue_status,
    hs_created_by_user_id,
    hs_msteams_message_id,
    hs_updated_by_user_id,
    si_jira_issue_summary,
    deployment_combination,
    first_agent_reply_date,
    hs_external_object_ids,
    hs_last_email_activity,
    hs_num_times_contacted,
    hs_unique_creation_key,
    internal__current_date,
    si_jira_issue_assignee,
    si_jira_issue_priority,
    si_jira_issue_reporter,
    data_validation_phase_i,
    hs_date_exited_19987999,
    hs_date_exited_19988000,
    hs_date_exited_19988001,
    hs_date_exited_19988002,
    hs_date_exited_19992996,
    hs_date_exited_19992999,
    hs_date_exited_19993000,
    hs_date_exited_19993001,
    hs_date_exited_20860049,
    hs_date_exited_20860050,
    hs_date_exited_20860051,
    hs_date_exited_21245461,
    hs_date_exited_21245462,
    hs_date_exited_21245463,
    hs_date_exited_21245465,
    hs_date_exited_21245466,
    hs_date_exited_21245467,
    hs_date_exited_21245468,
    hs_date_exited_21245470,
    hs_date_exited_23368876,
    hs_date_exited_23368877,
    hs_date_exited_23368878,
    hs_date_exited_24116806,
    hs_date_exited_24116807,
    hs_date_exited_24116808,
    hs_date_exited_24116809,
    hs_date_exited_25639711,
    hs_date_exited_25639712,
    hs_date_exited_25656404,
    hs_date_exited_26202701,
    hs_date_exited_26212533,
    hs_date_exited_26589470,
    hs_date_exited_26770989,
    hs_date_exited_26868919,
    hs_date_exited_27626397,
    hs_date_exited_27626398,
    hs_date_exited_27672668,
    hs_date_exited_27687309,
    hs_date_exited_27687310,
    hs_date_exited_27687311,
    hs_date_exited_27687312,
    hs_date_exited_27762617,
    hs_date_exited_27762688,
    hs_date_exited_27762689,
    hs_date_exited_27762690,
    hs_last_message_sent_at,
    hs_time_to_close_sla_at,
    unqualified_reason_code,
    data_validation_phase_ii,
    escalation_to_department,
    hs_date_entered_19987999,
    hs_date_entered_19988000,
    hs_date_entered_19988001,
    hs_date_entered_19988002,
    hs_date_entered_19992996,
    hs_date_entered_19992999,
    hs_date_entered_19993000,
    hs_date_entered_19993001,
    hs_date_entered_20860049,
    hs_date_entered_20860050,
    hs_date_entered_20860051,
    hs_date_entered_21245461,
    hs_date_entered_21245462,
    hs_date_entered_21245463,
    hs_date_entered_21245465,
    hs_date_entered_21245466,
    hs_date_entered_21245467,
    hs_date_entered_21245468,
    hs_date_entered_21245470,
    hs_date_entered_23368876,
    hs_date_entered_23368877,
    hs_date_entered_23368878,
    hs_date_entered_24116806,
    hs_date_entered_24116807,
    hs_date_entered_24116808,
    hs_date_entered_24116809,
    hs_date_entered_25639711,
    hs_date_entered_25639712,
    hs_date_entered_25656404,
    hs_date_entered_26202701,
    hs_date_entered_26212533,
    hs_date_entered_26589470,
    hs_date_entered_26770989,
    hs_date_entered_26868919,
    hs_date_entered_27626397,
    hs_date_entered_27626398,
    hs_date_entered_27672668,
    hs_date_entered_27687309,
    hs_date_entered_27687310,
    hs_date_entered_27687311,
    hs_date_entered_27687312,
    hs_date_entered_27762617,
    hs_date_entered_27762688,
    hs_date_entered_27762689,
    hs_date_entered_27762690,
    hs_thread_ids_to_restore,
    notes_next_activity_date,
    data_validation_phase_iii,
    hs_user_ids_of_all_owners,
    system_nexus_or_non_nexus,
    time_to_first_agent_reply,
    drop_temporary_description,
    hs_all_accessible_team_ids,
    hubspot_owner_assigneddate,
    hs_feedback_last_ces_rating,
    hs_last_message_received_at,
    hs_num_associated_companies,
    hs_sales_email_last_replied,
    hs_time_to_close_sla_status,
    hs_feedback_last_survey_date,
    phase_1__stage_1_count_of_day,
    hs_feedback_last_ces_follow_up,
    hs_first_agent_message_sent_at,
    nps_follow_up_question_version,
    hs_auto_generated_from_thread_id,
    hs_time_to_first_response_sla_at,
    hs_all_assigned_business_unit_ids,
    latest_date_of_status__migration_,
    hs_originating_email_engagement_id,
    hs_latest_message_seen_by_agent_ids,
    hs_time_to_first_response_sla_status,
    phase_1__stage_kick_off_sla_timestamp,
    hs_conversations_originating_thread_id,
    hs_conversations_originating_message_id,
    hs_user_ids_of_all_notification_followers,
    hs_user_ids_of_all_notification_unfollowers,
    _airbyte_ab_id,
    _airbyte_emitted_at,
    {{ current_timestamp() }} as _airbyte_normalized_at,
    _airbyte_properties_hashid
from {{ ref('tickets_properties_ab3') }}
-- properties at tickets/properties from {{ ref('tickets') }}
